# 后端开发规范

## 一、 技术栈要求 (后端)
- 后端框架：Spring Boot + mybatis-plus + jwt + feign
- 数据库：MySQL 5.7+
- 缓存：Redis 6.0+
- 验证码服务：邮件验证码服务, 短信验证码服务
- API 接口：RESTful API

## 二、 架构设计规范
- **分层架构**：项目采用模块化分层架构，明确各模块职责，禁止循环依赖。
- **模块划分**：
    1.  **common-module (公共组件模块)**：
        - 包含全局常量、工具类 (Utils)、全局异常处理 (GlobalExceptionHandler)、统一响应对象 (Result)、AOP 切面 (日志/权限) 等。
        - 路径：`common-module/src/main/java/{{PACKAGE_BASE}}/common`
    2.  **dal-module (数据访问层模块)**：
        - **职责**：负责所有与数据库交互的逻辑。 Entity (实体类)、Mapper (MyBatis接口)、XML 映射文件、DAL Service。
        - 路径：`dal-module/src/main/java/{{PACKAGE_BASE}}/dal`
    3.  **third-party-module (第三方服务模块)**：
        - **职责**：集成外部服务 (如短信、邮件、文件存储、支付等)。
        - 路径：`third-party-module/src/main/java/{{PACKAGE_BASE}}/thirdparty`
    4.  **业务模块 (biz-xxx-module)**：
        - **B端 (admin-xxx-module)**：接口路径前缀 `/admin/{module}/`，命名 `XxxAdminController`。
        - **C端 (frontend-xxx-module)**：接口路径前缀 `/api/{module}/`，命名 `XxxApiController`。
    5.  **hub-module (三方回调接口模块)**：
        - **职责**：接收第三方系统回调，路径 `/hub/{eventType}/{platform}/{tenantId}`。
    6.  **task-module (后台任务模块)**：
        - **职责**：定时任务、消息队列消费者、异步任务。

## 三、 命名规范
- **类命名**：`XxxEntity`, `XxxReq`, `XxxResp`/`XxxVO`, `XxxMapper`, `XxxService`, `XxxServiceImpl`, `XxxController`。
- **方法命名**：`getXxxByXxx`, `listXxx`, `pageXxx`, `createXxx`, `updateXxx`, `deleteXxxByXxx`。
- **字段命名**：Java 使用 **camelCase**，数据库使用 **snake_case**。

## 四、 核心设计规范
- **Redis Key**：`{业务前缀}:{模块名}:{具体标识}`，必须定义在常量类中。
- **日志规范**：使用 SLF4J + Logback，关键路径必须打印日志，异常必须打印堆栈。
- **事务规范**：`@Transactional(rollbackFor = Exception.class)`，仅在 Service 层使用。
- **并发控制**：涉及资金/库存必须使用分布式锁 (Redisson)。
- **幂等性**：支付、下单、状态流转等操作必须实现幂等。
- **参数校验**：Controller 层使用 JSR-303 注解，Service 层进行业务逻辑校验。
- **异常处理**：抛出自定义 `BusinessException`，由全局异常处理器统一捕获。

## 五、 第三方集成规范
- 定义统一接口继承 `IApiService`。
- 使用 Feign Client 调用，必须配置 `FeignLogger` 打印多行 `curl` 格式日志。

## 六、 异步处理规范
- 耗时操作使用 Spring Event + 线程池异步化。
- 必须实现任务状态跟踪 (PENDING/PROCESSING/SUCCESS/FAILED)。
