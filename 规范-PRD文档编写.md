# PRD文档编写规范

本文档旨在统一产品需求文档（PRD）的编写格式与内容规范，确保需求描述的清晰性、完整性及可落地性，降低沟通成本，提升开发效率。所有新功能或迭代需求均需遵循此规范。

## 一、 文档结构规范

一份完整的 PRD 文档应包含以下核心章节：

| 章节 | 必填 | 说明 |
| :--- | :---: | :--- |
| **1. 文档信息** | ✅ | 标题、版本、背景、目标、范围 |
| **2. 用户与流程** | ✅ | 角色定义、业务流程图 |
| **3. 功能需求** | ✅ | 按模块拆解，每个功能包含用户故事、交互逻辑、验收标准 |
| **4. 非功能需求** | ❌ | 性能、安全、兼容性 |
| **5. 数据字典** | ❌ | 枚举值、状态机、ER图 |

### 1. 文档信息 (Document Info)
*   **文档标题**：清晰简练，包含项目名称或功能模块（如：`商品分销系统-采购模块PRD`）。
*   **版本记录**：版本号、修订日期、修改人、修改内容摘要。
*   **项目背景**：
    *   **Why**：为什么要做？解决什么痛点？
    *   **What**：做什么？实现什么功能？
    *   **Goal**：期望达到什么业务效果？
*   **范围边界**：
    *   **In Scope**：本次包含什么？
    *   **Out of Scope**：本次不包含什么？（**必须明确**，防止范围蔓延）

### 2. 用户与流程 (Roles & Workflows)
*   **用户角色**：列出所有用户类型（如：品牌方、代理商、管理员）。
*   **业务流程图**：使用 Mermaid 展示核心路径，**格式如下**（禁止嵌套代码块）：
    *   明确开始/结束节点：`A[开始]`
    *   判断条件：`B{判断}`
    *   正常路径：`C -->|条件| D[操作]`
    *   异常路径：`C -->|否则| E[异常处理]`

### 3. 功能需求 (Functional Requirements)
按模块拆分，每个功能点包含以下子章节：

#### 3.1 功能概述
*   **功能名称**：如 `商品上架`
*   **用户故事**：`作为 [角色]，我想要 [功能]，以便 [价值]`
*   **优先级**：P0/P1/P2
*   **前置条件**：如 `用户已登录且具有品牌方权限`

#### 3.2 页面与字段
*   **页面原型**：描述布局（搜索区、列表区、操作区）
*   **字段定义表**：
    | 字段名称 | 字段类型 | 必填 | 默认值 | 校验规则 | 备注 |
    | :--- | :--- | :---: | :--- | :--- | :--- |
    | SKU编码 | 文本 | ✅ | 无 | 唯一性校验，不支持特殊字符 | 自动转大写 |
    | 价格 | 数字 | ✅ | 0.00 | >0，保留2位小数 | |

**字段类型标准化定义**（AI必须严格遵循）：
| 类型 | 后端 Java | 后端 Python | 前端 Vue/React | 数据库 |
| :--- | :--- | :--- | :--- | :--- |
| 文本 | `String` | `str` | `string` | `VARCHAR` |
| 数字 | `BigDecimal` | `Decimal` | `number` | `DECIMAL` |
| 整数 | `Integer` | `int` | `number` (parseInt) | `INTEGER` |
| 布尔 | `Boolean` | `bool` | `boolean` | `BOOLEAN` |
| 日期 | `LocalDate` | `date` | `Date` | `DATE` |
| 时间戳 | `LocalDateTime` | `datetime` | `Date` | `DATETIME` |
| 列表 | `List<String>` | `list` | `Array` | `JSON` |
| 富文本 | `String` (HTML) | `str` | `string` (v-html) | `TEXT` |

#### 3.3 交互逻辑
按步骤描述：
1.  进入页面时，默认加载...
2.  点击【保存】按钮：
    *   前端校验：...
    *   后端校验：...
    *   成功：提示"保存成功"，跳转至列表页
    *   失败：Toast 提示具体错误原因
3.  ...

#### 3.4 验收标准 (Acceptance Criteria)
**必须使用 Gherkin 语法**，格式：
```gherkin
Given [前置状态]
When [用户操作]
Then [预期结果]
```

**多场景验收标准示例**：
```gherkin
# 场景1：正常登录成功
Given 用户在登录页，输入已注册邮箱 "user@test.com" 和正确密码
When 用户点击【登录】按钮
Then 系统验证通过，返回 JWT Token
And 页面跳转至首页 /dashboard
And 用户信息存储至 LocalStorage: { "token": "xxx", "userId": 123 }

# 场景2：密码错误
Given 用户在登录页，输入邮箱 "user@test.com" 和错误密码 "wrong123"
When 用户点击【登录】按钮
Then 系统返回 401 状态码，错误信息 "密码错误"
And 前端显示红色提示文案：密码错误，剩余 4 次尝试机会
And 密码输入框获得焦点

# 场景3：账号锁定
Given 用户已连续 5 次输入错误密码，账号已被锁定
When 用户在登录页，输入正确密码
Then 系统返回 403 状态码，错误信息 "账号已锁定"
And 前端显示：账号已锁定，请 30 分钟后重试
And 登录按钮禁用，显示倒计时

# 场景4：邮箱格式错误
Given 用户在登录页，输入格式错误邮箱 "invalid-email"
When 用户点击【登录】按钮
Then 前端即时校验失败，邮箱输入框显示红色边框
And 邮箱输入框下方显示红色文案：请输入有效的邮箱地址
And 不发起后端请求
```

### 4. 非功能需求 (Non-functional Requirements)
*   **性能**：接口响应时间 < 200ms，支持并发 1000 QPS
*   **安全**：RBAC 权限控制，敏感数据加密
*   **兼容性**：Chrome 最新版、微信内置浏览器

### 5. 数据字典 (Data Dictionary)
*   **枚举值**：状态流转定义（如：订单状态机）
*   **全局规则**：通用交互规范、异常提示文案

---

## 二、 编写铁律 (AI 强制遵守)

> ⚠️ **以下规则 AI 必须 100% 执行，任何一条未遵守即判定为不合格输出**

1.  **字段必须表格化**：所有表单字段、枚举值、错误码必须用 Markdown 表格，禁止纯文本罗列。
2.  **交互必须具象化**：
    *   ❌ 禁止："友好的提示"
    *   ✅ 必须："弹出 Toast 提示：保存成功"
    *   ❌ 禁止："网络异常处理"
    *   ✅ 必须："网络超时 3 秒后，显示 Toast：网络连接失败，请检查网络设置"
3.  **数据流向必须明确**：在交互逻辑中需说明 `前端 → API → DB` 的数据走向。
4.  **每个功能必须有验收标准**：至少 1 条 Gherkin 格式的 Given-When-Then，覆盖核心路径。
5.  **范围边界必须明确**：在"范围边界"章节必须列出 Out of Scope，防止 AI 过度发挥。

---

## 三、 AI 生成规范 (Prompt Template)

### 角色设定
```
你是一位资深产品经理 (Expert PM)，精通 OpenSpec 规范。
你的任务是将用户的自然语言需求转化为结构化、无歧义的 PRD 文档。
输出时必须严格遵循《PRD文档编写规范》的格式要求。
```

### 输出格式约束

**AI 必须严格遵守以下格式**：

```markdown
# {项目名称} PRD

## 1. 文档信息
- **版本**：v1.0.0
- **日期**：YYYY-MM-DD
- **背景**：
  - Why：
  - What：
  - Goal：
- **范围边界**：
  - In Scope：
  - Out of Scope：

## 2. 用户与流程
- **用户角色**：
  - {角色1}：...
  - {角色2}：...
- **业务流程图**：
  graph LR
    A[开始] --> B{判断}
    B -->|是| C[操作1]
    B -->|否| D[操作2]

## 3. 功能需求

### 3.1 {功能模块名}

#### 3.1.1 {功能点1}
- **用户故事**：作为 [角色]，我想要 [功能]，以便 [价值]
- **优先级**：P0
- **前置条件**：[状态描述]
- **页面与字段**：
  | 字段 | 类型 | 必填 | 默认值 | 校验规则 | 备注 |
  | :--- | :--- | :---: | :--- | :--- | :--- |
  | ... | ... | ... | ... | ... | ... |
- **交互逻辑**：
  1. ...
  2. ...
- **验收标准**：
```gherkin
Given [前置]
When [操作]
Then [结果]
```

### 3.2 {功能点2}
...

## 4. 非功能需求
- **性能**：...
- **安全**：...

## 5. 数据字典
- **枚举值**：...
```

### 自检清单 (AI 生成后必须逐项检查)

**生成完 PRD 后，AI 必须用以下清单自检，任何一项不通过必须重新生成：**

| 检查项 | 检查标准 | 不合格判定 |
| :--- | :--- | :--- |
| **字段表格** | 所有字段定义是否都用了表格？| 存在纯文本字段描述 = 不合格 |
| **字段类型** | 是否使用了标准化类型（文本/数字/整数/布尔等）？| 使用"字符串"而非"文本" = 不合格 |
| **验收标准** | 是否每个功能都有 Gherkin 格式的 Given-When-Then？| 无验收标准 = 不合格 |
| **场景覆盖** | 验收标准是否覆盖了成功路径和至少 1 个异常路径？| 只有成功场景 = 不合格 |
| **范围边界** | 是否明确了 Out of Scope？| 未列出 Out of Scope = 不合格 |
| **Mermaid语法** | Mermaid 代码块是否独立（无嵌套）？| 嵌套代码块 = 不合格 |
| **交互具象化** | 是否避免了"友好的提示"等模糊词汇？| 发现模糊词汇 = 不合格 |

### Few-shot 示例

**用户输入**：
> "我要一个用户登录功能，支持邮箱登录，密码必须8位以上，错误5次锁定账号"

**AI 输出的 PRD 片段**：

```markdown
## 3. 功能需求

### 3.1 用户登录

#### 3.1.1 邮箱密码登录
- **用户故事**：作为 注册用户，我想要使用邮箱和密码登录系统，以便安全访问我的账户
- **优先级**：P0
- **前置条件**：用户已完成注册，账号未被锁定
- **页面与字段**：
  | 字段 | 类型 | 必填 | 默认值 | 校验规则 | 备注 |
  | :--- | :--- | :---: | :--- | :--- | :--- |
  | 邮箱 | 文本 | ✅ | 无 | 正则 ^[^\s@]+@[^\s@]+\.[^\s@]+$ | |
  | 密码 | 文本 | ✅ | 无 | 长度 8-20 位，支持字母、数字、特殊字符 | 前端显示掩码 |
- **交互逻辑**：
  1. 用户输入邮箱和密码，点击【登录】按钮
  2. 前端校验：邮箱格式校验、密码非空校验
  3. 后端校验：查询用户是否存在，校验密码 hash
  4. 校验失败：返回具体错误原因，前端显示错误提示
  5. 校验成功：生成 JWT Token，返回用户信息
- **验收标准**：
```gherkin
# 场景1：正常登录成功
Given 用户在登录页，输入已注册邮箱 "user@test.com" 和正确密码 "SecurePass123"
When 用户点击【登录】按钮
Then 系统验证通过，返回 JWT Token
And 页面跳转至首页 /dashboard
And 用户信息存储至 LocalStorage: { "token": "xxx", "userId": 123 }

# 场景2：密码错误
Given 用户在登录页，输入邮箱 "user@test.com" 和错误密码 "wrong123"
When 用户点击【登录】按钮
Then 系统返回 401 状态码，错误信息 "密码错误"
And 前端显示红色提示文案：密码错误，剩余 4 次尝试机会
And 密码输入框获得焦点并清空密码

# 场景3：账号锁定
Given 用户已连续 5 次输入错误密码，账号已被锁定
When 用户在登录页，输入正确密码
Then 系统返回 403 状态码，错误信息 "账号已锁定，30 分钟后自动解锁"
And 前端显示：账号已锁定，请 30 分钟后重试
And 登录按钮禁用，显示倒计时 UI
```

## 4. 非功能需求
- **安全**：密码错误 5 次锁定账号，锁定时间 30 分钟
- **性能**：登录接口响应时间 < 500ms
- **日志**：记录登录成功/失败日志，包含 IP、设备信息
```
